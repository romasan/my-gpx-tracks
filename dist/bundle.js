!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/dist",o(o.s=3)}([function(e){e.exports=JSON.parse('{"a":29536,"b":"37c9da3a9b91852ab74f08d70259d5be24ca7a48"}')},function(e,t,n){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n={};function i(e){return Math.floor(Math.abs(e)+.5)*(0<=e?1:-1)}function c(e,t,n){var r=(e=i(e*n))-(t=i(t*n));r<<=1,e-t<0&&(r=~r);for(var o="";32<=r;)o+=String.fromCharCode(63+(32|31&r)),r>>=5;return o+=String.fromCharCode(r+63)}function r(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].slice().reverse());return t}n.decode=function(e,t){for(var n,r=0,o=0,i=0,a=[],c=0,u=0,l=null,s=Math.pow(10,t||5);r<e.length;){for(l=null,c=0,u=0;u|=(31&(l=e.charCodeAt(r++)-63))<<c,c+=5,32<=l;);for(n=1&u?~(u>>1):u>>1,c=u=0;u|=(31&(l=e.charCodeAt(r++)-63))<<c,c+=5,32<=l;);o+=n,i+=1&u?~(u>>1):u>>1,a.push([o/s,i/s])}return a},n.encode=function(e,t){if(!e.length)return"";for(var n=Math.pow(10,t||5),r=c(e[0][0],0,n)+c(e[0][1],0,n),o=1;o<e.length;o++){var i=e[o],a=e[o-1];r+=c(i[0],a[0],n),r+=c(i[1],a[1],n)}return r},n.fromGeoJSON=function(e,t){if(!(e=e&&"Feature"===e.type?e.geometry:e)||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return n.encode(r(e.coordinates),t)},n.toGeoJSON=function(e,t){return{type:"LineString",coordinates:r(n.decode(e,t))}},"object"===t(e)&&e.exports&&(e.exports=n)}).call(this,n(2)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";n.r(t);function d(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=new ymaps.GeoObject({geometry:{type:"LineString",coordinates:t.coordinates},properties:{hintContent:t.label}},{strokeColor:t.color,strokeWidth:3,strokeOpacity:.5});return t.manual||(e.events.add("hover",function(e){e.originalEvent.target.options.set({strokeColor:"#0000ff",strokeOpacity:1,zIndex:999})}),e.events.add("mouseleave",function(e){e.originalEvent.target.options.set({strokeColor:t.color,strokeOpacity:.5,zIndex:0})})),e}var r=n(0),t=n(1),f=n.n(t),t=new Promise(function(e){ymaps.ready(e)}),c=null,u=null;function i(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function o(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?i(Object(o),!0).forEach(function(e){var t,n;t=r,e=o[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function a(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t.then(function(){c=new ymaps.Map("ymap",{center:[0,0],zoom:10,controls:["zoomControl","rulerControl","typeSelector"]}),ymaps.geolocation.get({provider:"browser",mapStateAutoApply:!0}).then(function(e){e.geoObjects.options.set("preset","islands#blueCircleIcon"),c.geoObjects.add(e.geoObjects)}),u=new ymaps.GeoObjectCollection,c.geoObjects.add(u)});function y(e,t){return t.reduce(function(e,t){return e&&e[t]},e)}function b(e){(o=document.createElement("div")).innerHTML=e;var t=(o.querySelector("gpx metadata name")||o.querySelector("gpx trk name")||{}).innerText,n=(o.querySelector("gpx metadata time")||{}).innerText,r=a((o.querySelector("gpx trk trkseg")||{}).children||[]),o=(e=r.map(function(e){return[parseFloat(e.attributes[0].value),parseFloat(e.attributes[1].value)]})).reduce(function(e,t){return{sum:e.prev?e.sum+(n=e.prev,r=t,o=s(n,2),i=o[0],a=o[1],c=s(r,2),u=c[0],l=c[1],n=Math.sin,o=Math.cos,r=Math.acos,c=Math.PI,u=c*u/180,l=c*(a-l)/180,l=n(i=c*i/180)*n(u)+o(i)*o(u)*o(l),l=60*(l=180*(l=r(l=1<l?1:l))/c)*1.1515,l*=1.60934):e.sum,prev:t};var n,r,o,i,a,c,u,l},{sum:0}).sum.toFixed(2);return{coordinates:e,label:'\n        <div style="color: grey">\n            '.concat(t?"<div>".concat(t,"</div>"):"","\n            ").concat(n?"<div>".concat(n,"</div>"):"","\n            <div>").concat(o," км.</div>\n        </div>\n    "),date:n,distance:o,duration:((new Date(y(r,[r.length-1,"children",1,"innerText"]))-new Date(y(r,[0,"children",1,"innerText"])))/36e5).toFixed(2)}}function m(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach(function(e){h(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}new Promise(function(e){document.addEventListener("DOMContentLoaded",e)}).then(function(){document.querySelector(".upload input").addEventListener("change",function(e){var r;r=e,new Promise(function(t){var e=r.target.files[0],n=new FileReader;n.onload=function(e){t(e.target.result)},e.name.includes(".gpx")&&n.readAsText(e)}).then(function(e){e=d(o(o({},b(e)),{},{color:"#0000ff",manual:!0}));u.add(e)})},!1)});function S(e){return A[e]||e}var A={All:"Все",Ride:"Велосипед",Walk:"Ходьба"};function P(e){var t=e.collection,n=e.list,r=e.type,o=e.year,i=e.id;t.removeAll(),n.forEach(function(e){"All"!==r&&e.type!==r||"Год"!==o&&e.year!=o||t.add(e.line),i&&e.id===i&&t.add(e.line)})}var x,t=O(new URL(location.href).searchParams.entries()).reduce(function(e,t){var n=g(t,2),t=n[0],n=n[1];return v(v({},e),{},h({},t,n))},{});t.code?(x=null,fetch("https://www.strava.com/oauth/token?"+[{client_id:r.a,client_secret:r.b,code:t.code,grant_type:"authorization_code"}].reduce(function(e,t){return Object.entries(t)},0).map(function(e){e=g(e,2);return e[0]+"="+e[1]}).join("&"),{method:"POST"}).then(function(e){return e.json()}).then(function(e){return x=e.access_token,e="https://www.strava.com/api/v3/athlete/activities?per_page=200".replace("{id}",e.athlete.id),fetch(e,{method:"GET",headers:new Headers({Authorization:"Bearer "+x})})}).then(function(e){return e.json()}).then(function(e){var n=["#FF0000","#00FF00","#0000FF","#8B00FF"],s=e.map(function(e){e=e.start_date;return new Date(e).toString().split(" ")[3]}).reduce(function(e,t){return e.includes(t)?e:e.concat([t])},[]).reduce(function(e,t){return v(v({},e),{},h({},t,n.shift()))},{});return e.map(function(e,t){var n=e.id,r=e.name,o=e.type,i=e.start_date,a=e.distance,c=e.elapsed_time,u=e.map,l=f.a.decode(u.summary_polyline),e=new Date(i).toString().split("GMT")[0],u=parseFloat((a/1e3).toFixed(3)),i=parseFloat((c/3600).toFixed(3)),a=Number(e.split(" ")[3]),c=s[a];return{id:n,type:o,line:d({coordinates:l,label:'\n                    <a href="https://www.strava.com/activities/'.concat(n,'" target="_blank">').concat(r,'</a>&nbsp;\n                    <a href="#').concat(n,'" class="only_me">#</a>\n                    <div style="color: grey">\n                        <div>').concat(e,"</div>\n                        <div>").concat(u," км. ").concat(i," ч.</div>\n                        <div>Тип: ").concat(S(o),"</div>\n                    </div>\n                "),color:c}),year:a,dist:u}})}).then(function(r){var t="Ride",n="Год",e=r.reduce(function(e,t){return e.includes(t.type)?e:[].concat(O(e),[t.type])},[]);e.unshift("All"),t=e.includes("Ride")?"Ride":e[0],P({collection:u,list:r,type:t,year:n}),c.setBounds(u.getBounds());var o=document.querySelector("#types");o.children[0].remove(),e.forEach(function(n){var e=document.createElement("option");e.value=n,e.innerText=S(n)+" ("+r.reduce(function(e,t){return e+~~("All"===n||t.type===n)},0)+")",n===t&&(e.selected=!0),o.appendChild(e)}),o.addEventListener("change",function(e){t=e.target.value,P({collection:u,list:r,type:t,year:n}),c.setBounds(u.getBounds())});var i=r.reduce(function(e,t){return e.includes(t.year)?e:[].concat(O(e),[t.year])},[]),a=document.querySelector("#years");i.forEach(function(n){var e=document.createElement("option");e.value=n;var t=~~r.reduce(function(e,t){return e+(t.year==n?t.dist:0)},0);e.innerText=n+("Год"!==n?" (".concat(t," km)"):""),a.appendChild(e)}),a.addEventListener("change",function(e){n=e.target.value,P({collection:u,list:r,type:t,year:n}),c.setBounds(u.getBounds())}),document.querySelector("#showLabels").addEventListener("change",function(t){r.forEach(function(e){e=e.line;t.target.checked?e.properties.setAll({hintContent:e.properties.getAll()._hintContent}):e.properties.setAll({_hintContent:e.properties.getAll().hintContent,hintContent:""})})}),document.body.addEventListener("click",function(e){var t;e.target.classList.contains("only_me")&&(t=Number(e.target.href.split("#").pop()),P({collection:u,list:r,id:t}),e.preventDefault())})})):location.href="https://www.strava.com/oauth/authorize?"+[{client_id:r.a,redirect_uri:location.href.split("?")[0],response_type:"code",scope:"read,activity:read_all,profile:read_all,read_all"}].reduce(function(e,t){return Object.entries(t)},0).map(function(e){e=g(e,2);return e[0]+"="+e[1]}).join("&")}]);